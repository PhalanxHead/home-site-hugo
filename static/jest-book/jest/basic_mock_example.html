<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>A Basic Mock Example - Jest Book</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.\mdbook-admonish.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../testing_introduction.html">Introduction to Testing</a></li><li class="chapter-item expanded affix "><li class="part-title">Jest</li><li class="chapter-item expanded "><a href="../jest/basic_structure.html"><strong aria-hidden="true">1.</strong> Basic Jest Testing Structure</a></li><li class="chapter-item expanded "><a href="../jest/matchers.html"><strong aria-hidden="true">2.</strong> Jest Matchers</a></li><li class="chapter-item expanded "><a href="../jest/repeated_tests.html"><strong aria-hidden="true">3.</strong> Repeated Tests with it.each()</a></li><li class="chapter-item expanded affix "><li class="part-title">Jest Mocks</li><li class="chapter-item expanded "><a href="../jest/mock_stub_spy.html"><strong aria-hidden="true">4.</strong> Mocking vs Stubbing vs Spying - A Comparison</a></li><li class="chapter-item expanded "><a href="../jest/basic_mock_example.html" class="active"><strong aria-hidden="true">5.</strong> A Basic Mock Example</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../jest/mocking_singleton.html"><strong aria-hidden="true">5.1.</strong> Mocking Singletons</a></li></ol></li><li class="chapter-item expanded "><a href="../jest/spying_analysis.html"><strong aria-hidden="true">6.</strong> Spying in Jest - When and Why</a></li><li class="chapter-item expanded affix "><li class="part-title">Nock + Jest</li><li class="chapter-item expanded "><a href="../nock/mocking_restapis.html"><strong aria-hidden="true">7.</strong> Mocking RestAPIs with Nock and Jest</a></li><li class="chapter-item expanded affix "><li class="part-title">AWS SDK v2</li><li class="chapter-item expanded "><a href="../aws-sdk/service-mock-sdk.html"><strong aria-hidden="true">8.</strong> Mocking Services with aws-sdk-mock</a></li><li class="chapter-item expanded "><a href="../aws-sdk/aws_errors.html"><strong aria-hidden="true">9.</strong> Mocking AWS Error Responses</a></li><li class="chapter-item expanded "><a href="../aws-sdk/aws_responses.html"><strong aria-hidden="true">10.</strong> Mocking AWS PromiseResult</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><a href="../jest/vscode_setup.html"><strong aria-hidden="true">11.</strong> Setup Jest in VsCode</a></li><li class="chapter-item expanded "><a href="../jest/handy_hacks.html"><strong aria-hidden="true">12.</strong> Boolean Logic in expect() clauses</a></li><li class="chapter-item expanded "><a href="../jest/samples.html"><strong aria-hidden="true">13.</strong> Expressiveness Example</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Jest Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <h1 id="a-mockstub-example"><a class="header" href="#a-mockstub-example">A Mock/Stub Example</a></h1>
<p>Why would you want to mock or stub a function? In essence it comes down to the structure of your unit test.</p>
<p>Typically, each test should be looking to verify one specific piece of behaviour, eg: <code>The SMS Service sends one SMS to each unique number in the recipient list</code> .</p>
<p>This description implies 2 things:</p>
<ul>
<li>The service is responsible for de-duplicating the recipient list</li>
<li>This service needs to call its SMS Provider once for each list item after de-duplication.</li>
</ul>
<p>Realistically, we don't care who the SMS provider is, or how they are told to send an SMS, those can be handled downstream or in integration testing.</p>
<p>We probably don't want to be sending real SMSes out in this case though! So let's mock/stub the SMS Provider.</p>
<p>We may or may not care, in this tests case, what the response from the SMS Provider call is. If we do, we would stub the function to return some reasonable response, and if we don't, a mock is sufficient.</p>
<p>It can also be used to stand in for long running compute functions that we don't necessarily want to run every time we run <code>yarn test</code> .</p>
<p>For example, if we have a file like this:</p>
<pre><code class="language-typescript">// /app/service/send-sms.ts
import { sendSms } from 'my_sms_library';

/**
 * Returns true when we successfully send an sms message
 */
export function sendSmsFromMe(destNumber: string, message: string): boolean {
  // Maybe do some validation on the destinationNumber

  try {
    const smsResponse = sendSms({
      sendingNumber: 'myNumber',
      destinationNumber: destNumber,
      message: message,
      apiKey: '&lt;some precofigured thing&gt;'
    });

    if(smsResponse.code === 200) {
      return true;
    }
  } catch { 
    return false; 
  }
  return false;
}
</code></pre>
<p>We may want to pretend to call <code>sendSms</code> instead of actually calling it (so we don't send a real sms out or spam the sms provider with junk).</p>
<p>However, Good Unit Testing principles dictate that we should make sure that <code>sendSmsFromMe</code> returns the correct response when <code>sendSms</code> gives us an error or something, so let's just pretend we own <code>sendSms</code> instead.</p>
<p>Below is the code for the minimal mock of the function where we tell it what we expect (I haven't tested this though whoops):</p>
<pre><code class="language-typescript">// /test/service/send-sms.test.ts
import { sendSms } from 'my_sms_library';
import { sendSmsFromMe } from '/app/service/send-sms.ts';

jest.mock('my_sms_library');
// You can also specify the mock type, but I haven't here.
const mockedSendSms = sendSms as jest.Mock;

describe('send-sms', () =&gt; {
  describe('sendSmsFromMe', () =&gt; {

    afterEach(() =&gt; {
      // Remove any lingering metadata about the mock
      mockedSendSms.clearMock();
    });

    it('Returns true when the service returns a 200 code', () =&gt; {
      mockedSendSms.mockResolvedValue({ code: 200, messageId: '123445315' });
      expect(sendSmsFromMe('&lt;my number&gt;', 'Hello stranger!')).toBe(true);
    });

    it('Returns false when the service returns something other than a 200 code', () =&gt; {
      mockedSendSms.mockResolvedValue({ code: 400, error: `That didn't work!` });
      expect(sendSmsFromMe('&lt;my number&gt;', 'Hello stranger!')).toBe(false);
    });

    it('Returns false when the service throws an error', () =&gt; {
      mockedSendSms.mockImplementation(() =&gt; {throw new Error(`Hey! I don't like that!`)});
      expect(sendSmsFromMe('&lt;my number&gt;', 'Hello stranger!')).toBe(false);
    });
  });
});
</code></pre>
<p>We can also interrogate the mock to see how many times it was called, and with what arguments.</p>
<p>It'd not be good for say, an SMS Api to accidentally get called multiple times to send 1 SMS, so this can be helpful to test.</p>
<pre><code class="language-typescript">// /test/service/send-sms.test.ts
import { sendSms } from 'my_sms_library';
import { sendSmsFromMe } from '/app/service/send-sms.ts';

jest.mock('my_sms_library');
// You can also specify the mock type, but I haven't here.
const mockedSendSms = sendSms as jest.Mock;

describe('send-sms', () =&gt; {
  describe('sendSmsFromMe', () =&gt; {

    afterEach(() =&gt; {
      // Remove any lingering metadata about the mock
      mockedSendSms.clearMock();
    });

    it('Returns true when the service returns a 200 code', () =&gt; {
      mockedSendSms.mockResolvedValue({ code: 200, messageId: '123445315' });
      expect(sendSmsFromMe('&lt;my number&gt;', 'Hello stranger!')).toBe(true);
    });

    it('Only calls the Sms Library once per sms request', () =&gt; {
      mockedSendSms.mockResolvedValue({ code: 200, messageId: '123445315' });
      sendSmsFromMe('&lt;my number&gt;', 'Hello stranger!');
      expect(mockedSendSms).toBeCalledTimes(1);
    });

    // You'd probably pre-configure these in some kind of config file, and you might keep a dummy copy in your repo for this particular test.
    it('Adds the api key and my number as the source!', () =&gt; {
      mockedSendSms.mockResolvedValue({ code: 200, messageId: '123445315' });
      sendSmsFromMe('&lt;my number&gt;', 'Hello stranger!');
      expect(mockedSendSms).toBeCalledWith({
        sendingNumber: 'myNumber',
        destinationNumber: '&lt;my number&gt;',
        message: 'Hello stranger!',
        apiKey: '&lt;some precofigured thing&gt;'
      });
    });

    // ... other tests redacted
  });
});
</code></pre>
<p>Don't forget you can use the scope of your containing block to reduce the number of strings you have to retype, or the number of similar mocks you need to set up!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../jest/mock_stub_spy.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../jest/mocking_singleton.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../jest/mock_stub_spy.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../jest/mocking_singleton.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>